<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ crew_check_meta.check.name if crew_check_meta.check else "Crew Check Form" }}</title>
  <style>
    /* Base */
    body {
      font-family: Arial, sans-serif;
      font-size: 14px;
      line-height: 1.5;
      margin: 20px;
      color: #333;
    }
    h1, h2, h3 {
      margin: 0 0 10px;
      color: #2d6a4f;
    }
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #2d6a4f;
    }
    .header h1 {
      font-size: 24px;
      font-weight: bold;
    }

    /* Info columns */
    .info-container {
      display: table;
      width: 100%;
      table-layout: fixed;
      margin-bottom: 20px;
    }
    .info-column {
      display: table-cell;
      padding: 10px;
      vertical-align: top;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .info-column + .info-column {
      margin-left: 10px;
    }
    .info-column p {
      margin: 5px 0;
    }

    /* Section Titles */
    .section h2 {
      font-size: 18px;
      border-bottom: 2px solid #2d6a4f;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }
    .section h3 {
      font-size: 16px;
      margin-top: 15px;
    }

    /* Assessment Table */
    .assessment-container {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    .assessment-container th,
    .assessment-container td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .assessment-container th {
      background: #2d6a4f;
      color: #fff;
      font-weight: bold;
    }
    /* Set fixed widths for columns */
    .assessment-container th:nth-child(1),
    .assessment-container td:nth-child(1) {
      width: 60%;
    }
    .assessment-container th:nth-child(2),
    .assessment-container td:nth-child(2) {
      width: 40%;
      text-align: center;
    }
    /* Zebra striping */
    .assessment-container tbody tr:nth-child(even) {
      background: #f8f9fa;
    }

    /* Radio Group Styling */
    .radio-group {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .radio-group label {
      flex: 1;
      text-align: center;
      font-weight: normal;
      margin: 0;
      padding: 4px 2px;
    }
    .radio-group input {
      margin-right: 4px;
    }

    /* Additional Info */
    .additional-info p {
      margin: 8px 0;
    }

    /* Page Break for PDF */
    @media print {
      .page-break { page-break-before: always; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>{{ crew_check_meta.check.name if crew_check_meta.check else "Crew Check Form" }}</h1>
  </div>

  <!-- Candidate & Check Details -->
  <div class="section">
    <div class="info-container">
      <div class="info-column">
        {% if 'candidate_name' in visible_fields %}
          <p><strong>Candidate Name:</strong> {{ crew_check_meta.candidate.username if crew_check_meta.candidate else "Unknown" }}</p>
        {% endif %}
        {% if 'licence_type' in visible_fields %}
          <p><strong>Licence Type:</strong> {{ crew_check_meta.candidate.license_type or "Not Provided" }}</p>
        {% endif %}
        {% if 'licence_number' in visible_fields %}
          <p><strong>Licence Number:</strong> {{ crew_check_meta.candidate.license_number or "Not Provided" }}</p>
        {% endif %}
      </div>
      <div class="info-column">
        {% if 'medical_expiry' in visible_fields %}
          <p><strong>Medical Expiry:</strong> {{ crew_check_meta.candidate.medical_expiry.strftime('%Y-%m-%d') if crew_check_meta.candidate and crew_check_meta.candidate.medical_expiry else "Not Provided" }}</p>
        {% endif %}
        {% if 'date_of_test' in visible_fields %}
          <p><strong>Date of Test:</strong> {{ crew_check_meta.date_of_test.strftime('%Y-%m-%d') if crew_check_meta.date_of_test else "Unknown" }}</p>
        {% endif %}
        {% if 'aircraft_type' in visible_fields %}
          <p><strong>Aircraft Type:</strong> {{ crew_check_meta.aircraft_type or "Unknown" }}</p>
        {% endif %}
      </div>
      <div class="info-column">
        {% if 'aircraft_registration' in visible_fields %}
          <p><strong>Aircraft Registration:</strong> {{ crew_check_meta.aircraft_registration or "Unknown" }}</p>
        {% endif %}
        {% if 'type_of_check' in visible_fields %}
          <p><strong>Type of Check:</strong> {{ crew_check_meta.type_of_check or "Not Specified" }}</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Assessment Criteria -->
  <div class="section">
    <h2>Assessment Criteria</h2>
    <table class="assessment-container">
      <thead>
        <tr>
          <th>Assessment Item</th>
          <th>Grading</th>
        </tr>
      </thead>
      <tbody>
        {% for item in crew_check_meta.check.items %}
        <tr>
          <td><strong>{{ item.item_name }}</strong></td>
          <td>
            <div class="radio-group">
              {% set grade_obj = item.grades | selectattr("crew_check_meta_id", "equalto", crew_check_meta.id) | list | first %}
              {% set selected = grade_obj.grade if grade_obj and grade_obj.grade is not none else "NA" %}
              {% for option in range(1,6) %}
                <label><input type="radio" name="item_{{ item.id }}" value="{{ option }}" disabled {% if selected|string == option|string %}checked{% endif %}>{{ option }}</label>
              {% endfor %}
              <label><input type="radio" name="item_{{ item.id }}" value="NA" disabled {% if selected|string == "NA" %}checked{% endif %}>NA</label>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="page-break"></div>

  <!-- Additional Information -->
  <div class="section">
    <h2>Additional Information</h2>
    {% if 'comments' in visible_fields %}
      <h3>Comments:</h3>
      <p>{{ crew_check_meta.comments or "None" }}</p>
    {% endif %}

    <div class="info-container">
      {% if 'flight_times' in visible_fields %}
      <div class="info-column">
        <p><strong>Flight Time (Day):</strong> {{ crew_check_meta.flight_time_day or "Not Recorded" }}</p>
        <p><strong>Flight Time (Night):</strong> {{ crew_check_meta.flight_time_night or "Not Recorded" }}</p>
        <p><strong>Flight Time (I/F):</strong> {{ crew_check_meta.flight_time_if or "Not Recorded" }}</p>
      </div>
      {% endif %}
      <div class="info-column">
        {% if 'current_check_due' in visible_fields %}
          <p><strong>Current Check Due:</strong> {{ crew_check_meta.current_check_due.strftime('%Y-%m-%d') if crew_check_meta.current_check_due else "Not Provided" }}</p>
        {% endif %}
        {% if 'test_result' in visible_fields %}
          <p><strong>Test Result:</strong> {{ crew_check_meta.test_result or "Not Available" }}</p>
        {% endif %}
        {% if 'logbook_sticker_issued' in visible_fields %}
          <p><strong>Logbook Sticker Issued:</strong> {{ crew_check_meta.logbook_sticker_issued or "Not Provided" }}</p>
        {% endif %}
      </div>
      <div class="info-column">
        {% if 'next_check_due' in visible_fields %}
          <p><strong>Next Check Due:</strong> {{ crew_check_meta.next_check_due.strftime('%Y-%m-%d') if crew_check_meta.next_check_due else "Not Provided" }}</p>
        {% endif %}
        {% if 'examiner_name' in visible_fields %}
          <p><strong>Examiner Name:</strong> {{ crew_check_meta.examiner_name or "Not Provided" }}</p>
        {% endif %}
        {% if 'examiner_license_number' in visible_fields %}
          <p><strong>Examiner Licence Number:</strong> {{ crew_check_meta.examiner_license_number or "Not Provided" }}</p>
        {% endif %}
      </div>
    </div>

    <div class="section">
      <h2>Assessment Comments</h2>
      {% for grade in crew_check_meta.grades if grade.grade_comment %}
        <p><strong>{{ grade.check_item.item_name }}:</strong> {{ grade.grade_comment }}</p>
      {% endfor %}
    </div>
  </div>
</body>
</html>
